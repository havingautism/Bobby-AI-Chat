# 主题系统实现文档

## 功能概述

实现了完整的明亮模式和暗夜模式切换系统，包括：

- 🌞 明亮模式和 🌙 暗夜模式切换
- 💾 主题偏好本地存储
- 🎨 代码块语法高亮主题切换
- 🔄 实时主题切换，无需刷新页面
- 📱 响应式设计支持

## 实现细节

### 1. 主题管理工具 (`src/utils/theme.js`)

- `getCurrentTheme()` - 获取当前主题
- `saveTheme(theme)` - 保存主题设置
- `toggleTheme()` - 切换主题
- `applyTheme(theme)` - 应用主题到 DOM
- `initTheme()` - 初始化主题

### 2. CSS 变量系统 (`src/App.css`)

定义了完整的 CSS 变量系统：

```css
:root {
  /* 明亮模式变量 */
  --bg-primary: #ffffff;
  --bg-secondary: #f8f9fa;
  --text-primary: #1f2937;
  /* ... 更多变量 */
}

[data-theme="dark"] {
  /* 暗夜模式变量 */
  --bg-primary: #1f2937;
  --bg-secondary: #111827;
  --text-primary: #f9fafb;
  /* ... 更多变量 */
}
```

### 3. 主题切换按钮

位置：左下角头像右边

- 明亮模式显示太阳图标 ☀️
- 暗夜模式显示月亮图标 🌙
- 支持收起状态下的显示

### 4. 代码块主题切换

- 明亮模式：使用 `vs` 主题
- 暗夜模式：使用 `vscDarkPlus` 主题
- 实时切换，无需重新渲染

### 5. 组件更新

#### Sidebar.js

- 添加主题状态管理
- 添加主题切换按钮
- 监听主题变化事件

#### CodeBlock.js

- 根据主题动态选择语法高亮样式
- 监听主题变化事件

#### App.js

- 应用启动时初始化主题
- 导入全局主题样式

### 6. 全局主题样式 (`src/styles/theme.css`)

- 统一的主题变量应用
- 输入框、按钮、滚动条等元素的主题化
- 动画和过渡效果
- 暗色模式特殊处理

## 使用方法

### 切换主题

点击左下角的主题切换按钮即可在明亮模式和暗夜模式之间切换。

### 程序化切换

```javascript
import { toggleTheme, saveTheme, THEMES } from "../utils/theme";

// 切换主题
toggleTheme();

// 设置特定主题
saveTheme(THEMES.DARK);
saveTheme(THEMES.LIGHT);
```

## 特性

### 1. 自动检测系统偏好

首次访问时会根据用户的系统偏好设置默认主题。

### 2. 持久化存储

主题选择会保存到 localStorage，下次访问时会记住用户的选择。

### 3. 实时切换

所有 UI 元素都会实时响应主题变化，包括：

- 背景色和文字颜色
- 边框和阴影
- 代码块语法高亮
- 滚动条样式
- 按钮和输入框样式

### 4. 响应式支持

在收起的侧边栏状态下，主题切换按钮会调整布局以适应较小的空间。

### 5. 无障碍支持

- 按钮有适当的 title 属性
- 颜色对比度符合无障碍标准
- 支持键盘导航

## 技术实现

### 事件系统

使用自定义事件 `themeChanged` 来通知所有组件主题已变化：

```javascript
window.dispatchEvent(new CustomEvent("themeChanged", { detail: theme }));
```

### CSS 变量

使用 CSS 自定义属性实现主题切换，确保所有样式都能实时更新。

### 组件状态同步

各个组件通过监听主题变化事件来同步更新自己的状态。

## 测试建议

1. 测试主题切换按钮功能
2. 验证代码块语法高亮是否正确切换
3. 检查所有 UI 元素的主题适配
4. 测试页面刷新后主题是否保持
5. 验证响应式布局下的主题切换
6. 测试系统偏好检测功能
